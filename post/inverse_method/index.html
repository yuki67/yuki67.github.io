<!DOCTYPE html>
<html lang="en">
    <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.30.2" />

  <title>逆関数法 &middot; yuki&#39;s blog</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://yuki67.github.io/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://yuki67.github.io/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="https://yuki67.github.io/css/blackburn.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  

  

  <link rel="shortcut icon" href="https://yuki67.github.io/img/favicon.ico" type="image/x-icon" />

  
  

</head>

    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <link rel="stylesheet" href="https://yuki67.github.io/css/custom.css">

    <body>
        <div id="layout">
            
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="https://yuki67.github.io/">yuki's blog</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://yuki67.github.io/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://yuki67.github.io/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://yuki67.github.io/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/yfkutydt" target="_blank"><i class="fa fa-twitter-square fa-fw"></i>Twitter</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/yuki67" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>by yuki</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>

            <div id="main">


<div class="header">
  <h1>逆関数法</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>2017-08-15</time>
  </div>

  

  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="https://yuki67.github.io/tags/python">python</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://yuki67.github.io/tags/math">math</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://yuki67.github.io/tags/%E3%82%B3%E3%83%BC%E3%83%89%E7%BD%AE%E3%81%8D%E5%A0%B4">コード置き場</a>
    
  </div>
  
  

</div>

  <p>ある分布が与えられたときにその分布に従う乱数を生成することを考える。</p>

<p></p>

<h2 id="理論">理論</h2>

<h3 id="事実">事実</h3>

<p>確率分布\(X\)が確率密度関数\({\it pdf }(x)\)で与えられたとする。</p>

<p>つまり、\(X\)から変数をランダムにとったとき\(x\)が選ばれる確率は\({\it pdf} (x)\)に比例し、かつ
\[
\int_{-\infty}^{\infty} {\it pdf }(x) dx = 1
\]
が成り立つとする。</p>

<p>この仮定のもとで、\({\it pdf}(x)\)の累積分布関数(commulative distribution function)を
\[
{\it cdf}(x) = \int_{-\infty}^{x} {\it pdf }(x) dx
\]
とする。</p>

<p>このとき、\(x\)を\([0, 1]\)の一様分布からとった変数とすると、\({\it cdf}^{-1}(x)\)は\(P\)に従う。
言い換えると、\(Y\)を\([0, 1]\)の一様分布としたとき、\(X \sim {\it cdf}^{-1}(Y)\)が成り立つ。</p>

<h3 id="証明">証明</h3>

<p>\(x\)を\([0, 1]\)の一様分布からとった変数とすると、任意の\(a \in [0, 1]\)に対して
\[
P(x \le a) = a
\]
である。</p>

<p>よって、与えられた\({\it pdf}(x)\)から計算した\({\it cdf}(x)\)について、
\[
P({\it cdf}^{-1}(x) \le {\it cdf}^{-1}(a)) = a
\]
が成り立つ。</p>

<p>\({\it cdf}^{-1}(a) = y\)とすると、\(a = {\it cdf}(y)\)でもあるから
\[
P({\it cdf}^{-1}(x) \le y) = {\it cdf}(y)
\]
となる。</p>

<p>\(\therefore\) \({\it cdf}^{-1}(x)\)は累積分布関数が\({\it cdf}\)であるような分布、すなわち\(X\)に従う。 \(\Box\)</p>

<p>(私は確率論をきちんと学んでいないので、この証明がどれぐらい正しいのか知らない。)</p>

<p>Physically Based Rendering, Third Edition の 753-754ページには、離散分布を使った直感的でわかりやすい説明が載っていた。</p>

<h2 id="実装">実装</h2>

<p>pythonでは <code>random.random()</code> を使うと \([0,1]\) の一様分布が得られるので、上で示した方法を使えば様々な分布に従う乱数を生成できる。実際にやってみる。</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style=";border-spacing:0;padding:0;margin:0;border:0;width:100%;overflow:auto;display:block;"><tr><td style=";vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#7f7f7f;margin-right:0.4em;padding:00.4em00.4em;display:block;">1</span><span style="color:#7f7f7f;margin-right:0.4em;padding:00.4em00.4em;display:block;">2</span><span style="color:#7f7f7f;margin-right:0.4em;padding:00.4em00.4em;display:block;">3</span><span style="color:#7f7f7f;margin-right:0.4em;padding:00.4em00.4em;display:block;">4</span><span style="color:#7f7f7f;margin-right:0.4em;padding:00.4em00.4em;display:block;">5</span><span style="color:#7f7f7f;margin-right:0.4em;padding:00.4em00.4em;display:block;">6</span></code></pre></td>
<td style=";vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#080;font-style:italic"># モジュールのインポート</span>
<span style="color:#666">%</span>matplotlib inline
<span style="color:#a2f;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">random</span>
<span style="color:#a2f;font-weight:bold">from</span> <span style="color:#00f;font-weight:bold">math</span> <span style="color:#a2f;font-weight:bold">import</span> sin, cos, exp, log
<span style="color:#a2f;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">numpy</span> <span style="color:#a2f;font-weight:bold">as</span> <span style="color:#00f;font-weight:bold">np</span>
<span style="color:#a2f;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">matplotlib.pyplot</span> <span style="color:#a2f;font-weight:bold">as</span> <span style="color:#00f;font-weight:bold">plt</span></code></pre></td></tr></table>
</div>
</div>
<h3 id="一様分布">一様分布</h3>

<p>\([a, b]\)の一様分布では \({\it pdf}(x)\) は (\(x \in [a,b]\) で)一定となる。</p>

<p>\({\it pdf}(x)\)の定義から\( \int_{a}^{b} {\it pdf}(x) dx = 1\)が成り立つので
\[
{\it pdf}(x) = \frac{1}{b-a}
\]
となる。(本当は\(x \notin [a, b]\)のときも考えなくてはいけないが、 \({\it pdf}(x)=0\)であり \({\it cdf}(x)\)の形も自明なので省略することにする。以降の例でも同様。)</p>

<p>これから、
\[
{\it cdf}(x) = \int_{-\infty}^{x} {\it pdf}(x) dx = \frac{x-a}{b-a}
\]
\[
\therefore {\it cdf}^{-1} (x) = (b-a)x + a
\]
となる。</p>

<p>これをコードにすると、以下のようになる。</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style=";border-spacing:0;padding:0;margin:0;border:0;width:100%;overflow:auto;display:block;"><tr><td style=";vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#7f7f7f;margin-right:0.4em;padding:00.4em00.4em;display:block;">1</span><span style="color:#7f7f7f;margin-right:0.4em;padding:00.4em00.4em;display:block;">2</span><span style="color:#7f7f7f;margin-right:0.4em;padding:00.4em00.4em;display:block;">3</span><span style="color:#7f7f7f;margin-right:0.4em;padding:00.4em00.4em;display:block;">4</span><span style="color:#7f7f7f;margin-right:0.4em;padding:00.4em00.4em;display:block;">5</span></code></pre></td>
<td style=";vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#080;font-style:italic"># [0, 1]の一様乱数を入力すると[a, b]の一様乱数を出力する関数を返す</span>
<span style="color:#a2f;font-weight:bold">def</span> <span style="color:#00a000">RNG_uniform</span>(a, b):
    <span style="color:#a2f;font-weight:bold">def</span> <span style="color:#00a000">cdf_inv</span>(x):
        <span style="color:#a2f;font-weight:bold">return</span> (b <span style="color:#666">-</span> a) <span style="color:#666">*</span> x <span style="color:#666">+</span> a
    <span style="color:#a2f;font-weight:bold">return</span> cdf_inv</code></pre></td></tr></table>
</div>
</div>
<p>グラフにプロットすれば、本当に関数の出力が一様乱数か確認できる。</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style=";border-spacing:0;padding:0;margin:0;border:0;width:100%;overflow:auto;display:block;"><tr><td style=";vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#7f7f7f;margin-right:0.4em;padding:00.4em00.4em;display:block;">1</span><span style="color:#7f7f7f;margin-right:0.4em;padding:00.4em00.4em;display:block;">2</span><span style="color:#7f7f7f;margin-right:0.4em;padding:00.4em00.4em;display:block;">3</span><span style="color:#7f7f7f;margin-right:0.4em;padding:00.4em00.4em;display:block;">4</span><span style="color:#7f7f7f;margin-right:0.4em;padding:00.4em00.4em;display:block;">5</span><span style="color:#7f7f7f;margin-right:0.4em;padding:00.4em00.4em;display:block;">6</span><span style="color:#7f7f7f;margin-right:0.4em;padding:00.4em00.4em;display:block;">7</span><span style="color:#7f7f7f;margin-right:0.4em;padding:00.4em00.4em;display:block;">8</span></code></pre></td>
<td style=";vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">fig, ax <span style="color:#666">=</span> plt<span style="color:#666">.</span>subplots(figsize<span style="color:#666">=</span>(<span style="color:#666">10</span>, <span style="color:#666">10</span>))
bins <span style="color:#666">=</span> <span style="color:#a2f">list</span>(np<span style="color:#666">.</span>arange(<span style="color:#666">0</span>, <span style="color:#666">10</span>, <span style="color:#666">0.05</span>))
<span style="color:#080;font-style:italic"># a, bの値を変えて3つ描画する</span>
ax<span style="color:#666">.</span>hist([RNG_uniform(<span style="color:#666">0</span>, <span style="color:#666">5</span>)(random<span style="color:#666">.</span>random()) <span style="color:#a2f;font-weight:bold">for</span> _ <span style="color:#a2f;font-weight:bold">in</span> <span style="color:#a2f">range</span>(<span style="color:#666">30000</span>)], bins<span style="color:#666">=</span>bins, alpha<span style="color:#666">=</span><span style="color:#666">0.35</span>, label<span style="color:#666">=</span><span style="color:#b44"></span><span style="color:#b44">&#34;[0, 5]&#34;</span>)
ax<span style="color:#666">.</span>hist([RNG_uniform(<span style="color:#666">4</span>, <span style="color:#666">6</span>)(random<span style="color:#666">.</span>random()) <span style="color:#a2f;font-weight:bold">for</span> _ <span style="color:#a2f;font-weight:bold">in</span> <span style="color:#a2f">range</span>(<span style="color:#666">30000</span>)], bins<span style="color:#666">=</span>bins, alpha<span style="color:#666">=</span><span style="color:#666">0.35</span>, label<span style="color:#666">=</span><span style="color:#b44"></span><span style="color:#b44">&#34;[4, 6]&#34;</span>)
ax<span style="color:#666">.</span>hist([RNG_uniform(<span style="color:#666">3</span>, <span style="color:#666">10</span>)(random<span style="color:#666">.</span>random()) <span style="color:#a2f;font-weight:bold">for</span> _ <span style="color:#a2f;font-weight:bold">in</span> <span style="color:#a2f">range</span>(<span style="color:#666">30000</span>)], bins<span style="color:#666">=</span>bins, alpha<span style="color:#666">=</span><span style="color:#666">0.35</span>, label<span style="color:#666">=</span><span style="color:#b44"></span><span style="color:#b44">&#34;[3, 10]&#34;</span>)
ax<span style="color:#666">.</span>legend()
fig</code></pre></td></tr></table>
</div>
</div>

<figure >
    
        <img src="https://yuki67.github.io/ox-hugo/RNG_uniform.png" />
    
    
</figure>


<h3 id="it-pdf-x---が--x--に比例する分布">\({\it pdf}(x)\) が \(x\) に比例する分布</h3>

<p>これはどのような分布かというと、変数 \(x\) を取ったとき\(x\) が \([0,1]\) に含まれる確率は \([1,2]\) に含まれる確率の半分となる分布である。</p>

<p>このような分布で、変数の範囲が \([a, b]\)であるものを考える。</p>

<p>\({\it pdf}(x) = cx\) とすると、\({\it pdf}(x)\) の条件
\[\int_{-\infty}^{\infty} {\it pdf }(x) dx = 1\]
から、
\[\int_{a}^{b} cx dx = \frac{c}{2} (b^{2} - a^{2}) = 1\]
\[\therefore c = \frac{2}{b^{2} - a^{2}}\]</p>

<p>よって</p>

<p>\begin{align}
{\it cdf}(x) & = \int_{-\infty}^{x} {\it pdf}(x) dx \\
             & = \int_{a}^{x} \frac{2x}{b^{2} - a^{2}} dx \\
             & = \frac{x^{2} - a^{2}}{b^{2} - a^{2}}
\end{align}
</p>

<p>これより
\[
{\it cdf}^{-1}(x) = \sqrt{(b^{2} - a^{2}) x + b^{2}}
\]</p>

<p>これをコードにすると以下のようになる。</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style=";border-spacing:0;padding:0;margin:0;border:0;width:100%;overflow:auto;display:block;"><tr><td style=";vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#7f7f7f;margin-right:0.4em;padding:00.4em00.4em;display:block;">1</span><span style="color:#7f7f7f;margin-right:0.4em;padding:00.4em00.4em;display:block;">2</span><span style="color:#7f7f7f;margin-right:0.4em;padding:00.4em00.4em;display:block;">3</span><span style="color:#7f7f7f;margin-right:0.4em;padding:00.4em00.4em;display:block;">4</span><span style="color:#7f7f7f;margin-right:0.4em;padding:00.4em00.4em;display:block;">5</span></code></pre></td>
<td style=";vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#080;font-style:italic"># [0, 1]の一様乱数を入力するとpdf(x)=cx (a &lt; x &lt; b) な乱数を返す関数を返す</span>
<span style="color:#a2f;font-weight:bold">def</span> <span style="color:#00a000">RNG_linear</span>(a, b):
    <span style="color:#a2f;font-weight:bold">def</span> <span style="color:#00a000">func</span>(x):
        <span style="color:#a2f;font-weight:bold">return</span> ((b<span style="color:#666">**</span><span style="color:#666">2</span> <span style="color:#666">-</span> a<span style="color:#666">**</span><span style="color:#666">2</span>)<span style="color:#666">*</span>x <span style="color:#666">+</span> a<span style="color:#666">**</span><span style="color:#666">2</span>)<span style="color:#666">**</span><span style="color:#666">0.5</span>
    <span style="color:#a2f;font-weight:bold">return</span> func</code></pre></td></tr></table>
</div>
</div>
<p>同様にグラフにする。</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style=";border-spacing:0;padding:0;margin:0;border:0;width:100%;overflow:auto;display:block;"><tr><td style=";vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#7f7f7f;margin-right:0.4em;padding:00.4em00.4em;display:block;">1</span><span style="color:#7f7f7f;margin-right:0.4em;padding:00.4em00.4em;display:block;">2</span><span style="color:#7f7f7f;margin-right:0.4em;padding:00.4em00.4em;display:block;">3</span><span style="color:#7f7f7f;margin-right:0.4em;padding:00.4em00.4em;display:block;">4</span><span style="color:#7f7f7f;margin-right:0.4em;padding:00.4em00.4em;display:block;">5</span><span style="color:#7f7f7f;margin-right:0.4em;padding:00.4em00.4em;display:block;">6</span><span style="color:#7f7f7f;margin-right:0.4em;padding:00.4em00.4em;display:block;">7</span><span style="color:#7f7f7f;margin-right:0.4em;padding:00.4em00.4em;display:block;">8</span></code></pre></td>
<td style=";vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">fig, ax <span style="color:#666">=</span> plt<span style="color:#666">.</span>subplots(figsize<span style="color:#666">=</span>(<span style="color:#666">10</span>, <span style="color:#666">10</span>))
bins <span style="color:#666">=</span> <span style="color:#a2f">list</span>(np<span style="color:#666">.</span>arange(<span style="color:#666">0</span>, <span style="color:#666">10</span>, <span style="color:#666">0.05</span>))
<span style="color:#080;font-style:italic"># a, bの値を変えて3つ描画する</span>
ax<span style="color:#666">.</span>hist([RNG_linear(<span style="color:#666">0</span>, <span style="color:#666">6</span>)(random<span style="color:#666">.</span>random()) <span style="color:#a2f;font-weight:bold">for</span> _ <span style="color:#a2f;font-weight:bold">in</span> <span style="color:#a2f">range</span>(<span style="color:#666">30000</span>)], bins<span style="color:#666">=</span>bins, alpha<span style="color:#666">=</span><span style="color:#666">0.35</span>, label<span style="color:#666">=</span><span style="color:#b44"></span><span style="color:#b44">&#34;[0, 6]&#34;</span>)
ax<span style="color:#666">.</span>hist([RNG_linear(<span style="color:#666">2</span>, <span style="color:#666">8</span>)(random<span style="color:#666">.</span>random()) <span style="color:#a2f;font-weight:bold">for</span> _ <span style="color:#a2f;font-weight:bold">in</span> <span style="color:#a2f">range</span>(<span style="color:#666">30000</span>)], bins<span style="color:#666">=</span>bins, alpha<span style="color:#666">=</span><span style="color:#666">0.35</span>, label<span style="color:#666">=</span><span style="color:#b44"></span><span style="color:#b44">&#34;[2, 8]&#34;</span>)
ax<span style="color:#666">.</span>hist([RNG_linear(<span style="color:#666">7</span>, <span style="color:#666">10</span>)(random<span style="color:#666">.</span>random()) <span style="color:#a2f;font-weight:bold">for</span> _ <span style="color:#a2f;font-weight:bold">in</span> <span style="color:#a2f">range</span>(<span style="color:#666">30000</span>)], bins<span style="color:#666">=</span>bins, alpha<span style="color:#666">=</span><span style="color:#666">0.35</span>, label<span style="color:#666">=</span><span style="color:#b44"></span><span style="color:#b44">&#34;[7, 10]&#34;</span>)
ax<span style="color:#666">.</span>legend()
fig</code></pre></td></tr></table>
</div>
</div>

<figure >
    
        <img src="https://yuki67.github.io/ox-hugo/RNG_linear.png" />
    
    
</figure>


<p>ここまでの二つの例における \({\it cdf}^{-1}(x)\)の形を見比べればわかるとおり、これらの考え方は\({\it pdf}(x) = cx^{n}\) の場合に一般化することができる。</p>

<h3 id="指数分布">指数分布</h3>

<p>\({\it pdf}(x) = ce^{-kx}\) で、変数の範囲が \([a, b]\) とする。</p>

<p>\({\it pdf}(x)\)の条件から
\[\int_{a}^{b} ce^{-kx} dx = \frac{c}{k} (e^{-ka} - e^{-kb}) = 1\]
\[\therefore c = \frac{k}{e^{-ka}-e^{-kb}}\]
よって</p>

<p>\begin{align}
{\it cdf}(x) & = \int_{a}^{x} \frac{k}{(e^{-ka} - e^{-kb})}e^{-kx} dx \\
             & = \frac{e^{-ka}-e^{-kx}}{e^{-ka} - e^{-kb}}
\end{align}
</p>

<p>\[\therefore {\it cdf}^{-1}(x) = - \frac{\log(e^{-ka} - (e^{-ka} - e^{-kb})x)}{k}\]</p>

<p>コードは</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style=";border-spacing:0;padding:0;margin:0;border:0;width:100%;overflow:auto;display:block;"><tr><td style=";vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#7f7f7f;margin-right:0.4em;padding:00.4em00.4em;display:block;">1</span><span style="color:#7f7f7f;margin-right:0.4em;padding:00.4em00.4em;display:block;">2</span><span style="color:#7f7f7f;margin-right:0.4em;padding:00.4em00.4em;display:block;">3</span><span style="color:#7f7f7f;margin-right:0.4em;padding:00.4em00.4em;display:block;">4</span><span style="color:#7f7f7f;margin-right:0.4em;padding:00.4em00.4em;display:block;">5</span></code></pre></td>
<td style=";vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#080;font-style:italic"># [0, 1]の一様乱数を入力するとpdf(x)=ce^(-kx) (a &lt; x &lt; b) な乱数を返す関数を返す</span>
<span style="color:#a2f;font-weight:bold">def</span> <span style="color:#00a000">RNG_exp</span>(k, a, b):
    <span style="color:#a2f;font-weight:bold">def</span> <span style="color:#00a000">func</span>(x):
        <span style="color:#a2f;font-weight:bold">return</span> <span style="color:#666">-</span>log(exp(<span style="color:#666">-</span>k<span style="color:#666">*</span>a) <span style="color:#666">-</span> x<span style="color:#666">*</span>(exp(<span style="color:#666">-</span>k<span style="color:#666">*</span>a) <span style="color:#666">-</span> exp(<span style="color:#666">-</span>k<span style="color:#666">*</span>b))) <span style="color:#666">/</span> k
    <span style="color:#a2f;font-weight:bold">return</span> func</code></pre></td></tr></table>
</div>
</div>
<p>グラフは</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style=";border-spacing:0;padding:0;margin:0;border:0;width:100%;overflow:auto;display:block;"><tr><td style=";vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#7f7f7f;margin-right:0.4em;padding:00.4em00.4em;display:block;">1</span><span style="color:#7f7f7f;margin-right:0.4em;padding:00.4em00.4em;display:block;">2</span><span style="color:#7f7f7f;margin-right:0.4em;padding:00.4em00.4em;display:block;">3</span><span style="color:#7f7f7f;margin-right:0.4em;padding:00.4em00.4em;display:block;">4</span><span style="color:#7f7f7f;margin-right:0.4em;padding:00.4em00.4em;display:block;">5</span><span style="color:#7f7f7f;margin-right:0.4em;padding:00.4em00.4em;display:block;">6</span><span style="color:#7f7f7f;margin-right:0.4em;padding:00.4em00.4em;display:block;">7</span><span style="color:#7f7f7f;margin-right:0.4em;padding:00.4em00.4em;display:block;">8</span></code></pre></td>
<td style=";vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">fig, ax <span style="color:#666">=</span> plt<span style="color:#666">.</span>subplots(figsize<span style="color:#666">=</span>(<span style="color:#666">10</span>, <span style="color:#666">10</span>))
bins <span style="color:#666">=</span> <span style="color:#a2f">list</span>(np<span style="color:#666">.</span>arange(<span style="color:#666">1</span>, <span style="color:#666">5</span>, <span style="color:#666">0.025</span>))
<span style="color:#080;font-style:italic"># k, a, bの値を変えて3つ描画する</span>
ax<span style="color:#666">.</span>hist([RNG_exp(<span style="color:#666">1</span>, <span style="color:#666">1</span>, <span style="color:#666">10</span>)(random<span style="color:#666">.</span>random()) <span style="color:#a2f;font-weight:bold">for</span> _ <span style="color:#a2f;font-weight:bold">in</span> <span style="color:#a2f">range</span>(<span style="color:#666">30000</span>)], bins<span style="color:#666">=</span>bins, alpha<span style="color:#666">=</span><span style="color:#666">0.35</span>, label<span style="color:#666">=</span><span style="color:#b44"></span><span style="color:#b44">&#34;k=1, [1, 10]&#34;</span>)
ax<span style="color:#666">.</span>hist([RNG_exp(<span style="color:#666">2</span>, <span style="color:#666">1</span>, <span style="color:#666">10</span>)(random<span style="color:#666">.</span>random()) <span style="color:#a2f;font-weight:bold">for</span> _ <span style="color:#a2f;font-weight:bold">in</span> <span style="color:#a2f">range</span>(<span style="color:#666">30000</span>)], bins<span style="color:#666">=</span>bins, alpha<span style="color:#666">=</span><span style="color:#666">0.35</span>, label<span style="color:#666">=</span><span style="color:#b44"></span><span style="color:#b44">&#34;k=2, [1, 10]&#34;</span>)
ax<span style="color:#666">.</span>hist([RNG_exp(<span style="color:#666">1</span>, <span style="color:#666">1</span>, <span style="color:#666">2</span>)(random<span style="color:#666">.</span>random()) <span style="color:#a2f;font-weight:bold">for</span> _ <span style="color:#a2f;font-weight:bold">in</span> <span style="color:#a2f">range</span>(<span style="color:#666">30000</span>)], bins<span style="color:#666">=</span>bins, alpha<span style="color:#666">=</span><span style="color:#666">0.35</span>, label<span style="color:#666">=</span><span style="color:#b44"></span><span style="color:#b44">&#34;k=1, [1, 5]&#34;</span>)
ax<span style="color:#666">.</span>legend()
fig</code></pre></td></tr></table>
</div>
</div>

<figure >
    
        <img src="https://yuki67.github.io/ox-hugo/RNG_exp.png" />
    
    
</figure>


<p>なお前の式で\(k=1\), \(b = \infty\) とすると
\[{\it cdf}^{-1}(x) = a \log(1-x)\]
となってかなり簡単になる。</p>

<h3 id="その他">その他</h3>

<p>逆関数法を使って乱数が求められる分布は他にもあるが省略。</p>

<p>逆関数法を使わないでも乱数が求められる分布もある。</p>

<p>例えば、 \(X_{1}, \dots , X_{n}\) を \([a, b]\) の一様分布に従う変数としたとき
\[ X = max(X_{1}, \dots, X_{n})\]
とすると、 \(X\) は \({\it pdf(x) = cx^{n}}\) かつ \(X \in [a, b]\) な分布に従う。</p>

<p>このことは</p>

<p>\begin{align}
P(X = x) & = P(x_{1} \leq x \land , \dots , \land x_{n} \leq x) \\
         & = \prod_{i=1}^{n} P(x_{i} \leq x) & (\because x_{i} は独立) \\
         & \sim \prod_{i=1}^{n} x & (\because x_{i}は一様分布に従う) \\
         & = x^{n}
\end{align}
</p>

<p>からわかる。</p>

<p>逆関数法を使わないで乱数を求める他の方法として、ボックスミュラー法がある。</p>

<h2 id="参考文献">参考文献</h2>

<p>Physically Based Rendering, Third Edition, Chapter13 &ldquo;Monte Carlo Integration&rdquo;</p>

<p>Ray Tracing: The Rest Of Your Life (Ray Tracing Minibooks Book 3), Chapter2 &ldquo;One Dimentional MC Integral&rdquo;</p>

  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="https://yuki67.github.io/post/montecarlo_integral/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="https://yuki67.github.io/post/montecarlo_integral/">モンテカルロ積分</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="https://yuki67.github.io/post/perlin_noise/">パーリンノイズ</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="https://yuki67.github.io/post/perlin_noise/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>



  

</div>

</div>
</div>
<script src="https://yuki67.github.io/js/ui.js"></script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-107335237-1', 'auto');
  ga('send', 'pageview');

</script>





</body>
</html>

